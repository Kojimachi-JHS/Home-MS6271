<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>TOTP認証</title>
  </head>
  <main>
    <h1>TOTP認証</h1>
    <input type="text" id="code" placeholder="TOTPコード">
    <input type="submit" id="submit" name="認証">

    <script>
      const code = document.querySelector("input[name='code']").value;
      const secret = "ff33cdd7388c018190e339797422570a72d5ec7a9f886aa90d43efc5790c266a3ccee0ae250c1c426c460bd0b5239d32caf3e3257fb207a4878135883f826c68";
      const interval = 30;

      const generateCode = () => {
        const time = Math.floor(new Date().getTime() / interval);
        return sha256(secret + time).slice(-8);
      };

      const checkCode = (code) => {
        return code === generateCode();
      };

      document.querySelector("input[type='submit']").addEventListener("click", () => {
        if (checkCode(document.querySelector("input[name='code']"))) {
          window.location.href = "/destination";
        } else {
          alert("TOTPコードが正しくありません。");
        }
      });
    </script>
  </main>
</html>